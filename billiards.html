

<html>
  
  <head>
    <title>Billiards</title>
    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
    <link rel="stylesheet" href="graphics.css">

    <style>
    html, body {
        padding: 0px;
        margin: 0px;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }
    canvas {
        width: 100%;
        height: 100%;
        border: none;
    }
    </style>

    <script type="text/javascript" src="common/MV.js"></script>
    <script type="text/javascript" src="common/webgl-utils.js"></script>
    <script type="text/javascript" src="common/initShaders.js"></script>

    <script id="billiardtable-vert" type="x-shader/x-vertex">
      attribute vec3 vertexPosition;
      attribute vec2 vertexUV;
      attribute vec3 vertexNormal;
      
      uniform mat4 modelViewMatrix;
      uniform mat4 projectionMatrix;
      
      varying highp vec2 uv;
      varying vec3 normal;
      
      void main(void) {
        gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);
        uv = vec2(vertexUV.s, 1.0 - vertexUV.t);
        normal = vertexNormal;
      }
    </script>
    <script id="billiardtable-frag" type="x-shader/x-fragment">
      precision mediump float;

      varying highp vec2 uv;
      varying vec3 normal;

      uniform sampler2D textureSampler;

      void main(void) {
        gl_FragColor = texture2D(textureSampler, uv);
      }
    </script>

    <script id="cuestick-vert" type="x-shader/x-vertex">
      attribute vec3 vertexPosition;
      attribute vec2 vertexUV;
      attribute vec3 vertexNormal;
      
      uniform mat4 modelViewMatrix;
      uniform mat4 projectionMatrix;

      varying highp vec2 uv;
      varying vec3 normal;
      
      void main(void) {
        gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);
        uv = vec2(vertexUV.s, 1.0 - vertexUV.t);
        normal = vertexNormal;
      }
    </script>

    <script id="billiardball-vert" type="x-shader/x-vertex">
      attribute vec3 vertexPosition;
      attribute vec2 vertexUV;
      attribute vec3 vertexNormal;
      
      uniform mat4 modelViewMatrix;
      uniform mat4 projectionMatrix;
      
      varying highp vec2 uv;
      varying vec3 normal;
      
      void main(void) {
        gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);
        uv = vec2(vertexUV.s, 1.0 - vertexUV.t);
        normal = vertexNormal;
      }
    </script>
    <script id="billiardball-frag" type="x-shader/x-fragment">
      precision mediump float;

      varying highp vec2 uv;
      varying vec3 normal;

      uniform sampler2D textureSampler;

      void main(void) {
        gl_FragColor = vec4(texture2D(textureSampler, uv).rgb, 1.0);
      }
    </script>

    <script id="billiardball-sdf-vert" type="x-shader/x-vertex">
      attribute vec3 vertexPosition;
      attribute vec2 vertexUV;
      attribute vec3 vertexNormal;
      
      uniform mat4 modelViewMatrix;
      uniform mediump mat4 projectionMatrix;
      
      varying mediump vec2 uv;
      varying vec3 normal;
      
      void main(void) {
        gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);
        uv = vec2(vertexUV.s, 1.0 - vertexUV.t);
        normal = vertexNormal;
      }
    </script>
    <script id="billiardball-sdf-frag" type="x-shader/x-fragment">
      // Signed distance fields for crisp lettering, based on Chris Green's paper
      // See here: <http://www.valvesoftware.com/publications/2007/SIGGRAPH2007_AlphaTestedMagnification.pdf>
      precision mediump float;

      varying mediump vec2 uv;
      varying vec3 normal;

      uniform mediump mat4 projectionMatrix;

      uniform sampler2D nearTexture;
      uniform sampler2D farTexture;
      uniform sampler2D numberMask;
      uniform vec3 outsideColor;
      uniform vec3 insideColor;

      void main(void) {
        // Math for Z-depth from gl_fragCoord.z comes from Lengyel,
        // "Mathematics for 3D Game Programming and Computer Graphics, Third
        // Edition" page 114.
        float a = projectionMatrix[2][2];
        float b = projectionMatrix[3][2];
        float zPos = -(((gl_FragCoord.z + a)*(-1.0/b))/1.0 + 1.0);
        vec4 baseColor;
        if (zPos < -0.2) {  // Arbitrary, 0.2 meters
          // Use our far texture for balls far away
          baseColor = texture2D(farTexture, uv);
        } else {
          // Use our  texture for balls close up
          baseColor = texture2D(nearTexture, uv);
        }
        float distAlphaMask = baseColor.a;
        vec4 numberMask = texture2D(numberMask, uv);
        if (distAlphaMask <= 0.5) {
          if (numberMask.a > 0.9) {
            // Make the lettering black
            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(insideColor.rgb, 1.0);
          }
        } else {
          gl_FragColor = vec4(outsideColor.rgb, 1.0);
        }
      }
    </script>

    <script id="cuestick-vert" type="x-shader/x-vertex">
      attribute vec3 vertexPosition;
      attribute vec2 vertexUV;
      attribute vec3 vertexNormal;
      
      uniform mat4 modelViewMatrix;
      uniform mat4 projectionMatrix;

      varying highp vec2 uv;
      varying vec3 normal;
      
      void main(void) {
        gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);
        uv = vec2(vertexUV.s, 1.0 - vertexUV.t);
        normal = vertexNormal;
      }
    </script>
    <script id="cuestick-frag" type="x-shader/x-fragment">
      precision mediump float;

      varying highp vec2 uv;
      varying vec3 normal;

      uniform sampler2D textureSampler;
      uniform float fadeAlpha;

      void main(void) {
        gl_FragColor = vec4(texture2D(textureSampler, uv).rgb, fadeAlpha);
      }
    </script>

    <script id="debug-vert" type="x-shader/x-vertex">
      attribute vec3 vertexPosition;
      
      uniform mat4 modelViewMatrix;
      uniform mat4 projectionMatrix;
      
      void main(void) {
        gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);
      }
    </script>
    <script id="debug-frag" type="x-shader/x-fragment">
      precision mediump float;

      void main(void) {
        gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
      }
    </script>

    <!------------------------------------------------------------>
    <!-- This is the file you will modify -->
    <!------------------------------------------------------------>
    <script type="text/javascript" src="billiards.js"></script>
  </head>
  
  <body>
    <canvas id="gl-canvas"></canvas>
  </body>
  
</html>
